swagger: '2.0'
info:
  description: Store service for eDropin
  version: 1.0.0
  title: eDropin Store
  license:
    name: UNLICENSED
  contact:
    name: Saj Arora
    email: dev@edropin.com
host: 'store-dot-edropin-play.appspot.com'
basePath: /
tags:
  - name: esMerchants
    description: Merchant management
  - name: esStore
    description: Store management
  - name: esCart
    description: User Cart for store items
  - name: esOrder
    description: Order items for user
  - name: esCustomers
    description: Customers of eDropin
schemes:
  - https
produces:
  - application/json
securityDefinitions:
  Authorization:
    type: apiKey
    in: header
    name: Authorization
  ClientKey:
    type: apiKey
    in: header
    name: X-Client-Key
security:
  - ClientKey: []
    Authorization: []
paths:
  ### Merchants
  '/merchants/{merchantId}':
    parameters:
      - $ref: '#/parameters/merchantId'
    get:
      tags:
        - esMerchants
      summary: Get a Merchant from the directory
      operationId: getMerchant
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsMerchant'
        '400':
          description: Invalid ID supplied
        '404':
          description: Store Item not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    put:
      tags:
        - esMerchants
      summary: Enable billing
      operationId: enableBilling
      parameters:
        - in: body
          name: stripeCode
          description: Stripe Code To Enable Billing
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Billing updated
          schema:
            $ref: '#/definitions/EsMerchant'
        '400':
          description: Invalid ID supplied
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Profile not found
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  
  '/merchants/{merchantId}/fee-structure':
    parameters:
      - $ref: '#/parameters/merchantId'
    put:
      tags:
        - esMerchants
      summary: Setup fee structure for merchant [Admin Only]
      operationId: updateFeeStructure
      parameters:
        - in: body
          name: feeProps
          required: true
          description: Fee structure
          schema:
            type: object
            additionalProperties:
              $ref: '#/definitions/EsFeeStructure'
      responses:
        '200':
          description: Merchant fee structure updated
          schema:
            $ref: '#/definitions/EsMerchant'
        '400':
          description: Invalid ID supplied
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Profile not found
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
          
  '/merchants/{merchantId}/permissions/{accountId}':
    parameters:
      - $ref: '#/parameters/merchantId'
      - $ref: '#/parameters/accountId'
    get:
      tags:
        - esMerchants
      summary: Get permission for account
      operationId: getAccountPermissionForMerchant
      responses:
        '200':
          description: Permissions for account
          schema:
            $ref: "#/definitions/EsPermission"
        '401':
          $ref: '#/responses/UnauthorizedError'
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    put:
      tags:
        - esMerchants
      summary: Set permission for merchant
      operationId: setMerchantPermission
      parameters:
        - in: body
          name: permissionProps
          description: Permissions
          required: true
          schema:
            $ref: '#/definitions/EsPermissionInput'
      responses:
        '200':
          description: Permission set
          schema:
            $ref: '#/definitions/EsPermission'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/merchants/{merchantId}/permissions/{accountId}/check':
    parameters:
      - $ref: '#/parameters/merchantId'
      - $ref: '#/parameters/accountId'
    get:
      tags:
        - esMerchants
      summary: Check account has permission
      operationId: checkAccountHasPermission
      parameters:
        - in: query
          type: string
          required: true
          name: permission
      responses:
        '200':
          description: Account has Permission
          schema:
            $ref: '#/definitions/EsPermissionCheck'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/merchants/{merchantId}/all-permissions':
    parameters:
      - $ref: '#/parameters/merchantId'
    get:
      tags:
        - esMerchants
      summary: List all merchant permissions
      operationId: getMerchantPermission
      parameters:
        - $ref: '#/parameters/cursor'
        - $ref: '#/parameters/limit'
      responses:
        '200':
          description: List of Users with permissions linked to this merchant
          schema:
            $ref: '#/definitions/EsPagedPermission'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  
  ### End of Merchants
  
  
  ### Store
  '/store/{merchantId}/items':
    get:
      parameters:
        - $ref: '#/parameters/merchantId'
        - $ref: '#/parameters/cursor'
        - $ref: '#/parameters/limit'
      tags:
        - esStore
      summary: Get all store items for merchant
      operationId: listStoreItems
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsPagedStoreItem'
        '400':
          description: Invalid ID supplied
        '404':
          description: Store Item not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    
  '/store/{merchantId}/items/{itemId}':
    parameters:
      - $ref: '#/parameters/merchantId'
      - $ref: '#/parameters/itemId'
    get:
      tags:
        - esStore
      summary: Get a store item from the directory
      operationId: getStoreItem
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsStoreItem'
        '400':
          description: Invalid ID supplied
        '404':
          description: Store Item not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    put:
      tags:
        - esStore
      summary: Upsert a store item
      operationId: upsertStoreItem
      parameters:
        - in: body
          name: storeItemProps
          description: Store Item that needs to be upserted
          required: true
          schema:
            $ref: '#/definitions/EsStoreItemUpdate'
      responses:
        '200':
          description: Store Item updated
          schema:
            $ref: '#/definitions/EsStoreItem'
        '400':
          description: Invalid ID supplied
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Store Item not found
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    delete:
      tags:
        - esStore
      summary: Delete an existing Store Item
      operationId: deleteStoreItem
      responses:
        '204':
          description: Event deleted
          schema:
            type: object
        '400':
          description: Invalid ID supplied
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: StoreItem not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  ### End of Store
  
  ### Cart
  '/cart':
    get:
      tags:
        - esCart
      summary: Get the users current cart
      operationId: getUserCart
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsCart'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    delete:
      tags:
        - esCart
      summary: Empty the user cart
      operationId: emptyCart
      responses:
        '204':
          description: Cart deleted
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Cart not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/cart/upsert/merchants/{merchantId}/items/{itemId}':
    parameters:
      - $ref: '#/parameters/merchantId'
      - $ref: '#/parameters/itemId'
    put:
      tags:
        - esCart
      summary: Upsert item to cart
      operationId: upsertCartItem
      parameters:
        - in: body
          name: cartItemProps
          description: Cart Item that needs to be upserted
          required: true
          schema:
            $ref: '#/definitions/EsCartItemInput'
      responses:
        '200':
          description: Cart Item upserted
          schema:
            $ref: '#/definitions/EsCart'
        '400':
          description: Invalid ID supplied
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Cart Store Item not found
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    delete:
      tags:
        - esCart
      summary: Delete a cart item
      operationId: deleteCartItem
      responses:
        '204':
          description: Cart Item deleted
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Cart Item not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/carts/validate':
    post:
      tags:
        - esCart
      summary: Validate Cart to ensure all items are available and pricing is all right
      operationId: validateCart
      responses:
        '200':
          description: Cart Item validated
          schema:
            $ref: '#/definitions/EsCart'
        '400':
          description: Invalid ID supplied
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Cart Store Item not found
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/carts/checkout':
    post:
      tags:
        - esCart
      summary: Payment information to process all cart items
      parameters:
        - in: body
          name: paymentProps
          description: Payment props for checkout
          required: true
          schema:
            $ref: '#/definitions/EsPaymentInput'
      operationId: checkoutCart
      responses:
        '200':
          description: Order
          schema:
            type: array
            items:
              $ref: '#/definitions/EsOrder'
        '400':
          description: Invalid ID supplied
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Cart Store Item not found
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  
  ### End of Cart
  
  ### Orders
  '/merchants/{merchantId}/orders':
    get:
      tags:
        - esOrder
      summary: Get orders for by merchant (merchant use only)
      parameters:
        - $ref: '#/parameters/merchantId'
        - $ref: '#/parameters/cursor'
        - $ref: '#/parameters/limit'
      operationId: listOrdersByMerchant
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsPagedOrder'
        '400':
          description: Invalid ID supplied
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  
  '/orders':
    get:
      tags:
        - esOrder
      summary: Get orders for current user
      parameters:
        - in: query
          name: merchantId
          required: false
          type: string
        - $ref: '#/parameters/cursor'
        - $ref: '#/parameters/limit'
      operationId: listOrders
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsPagedOrder'
        '400':
          description: Invalid ID supplied
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/orders/{orderId}':
    parameters:
      - $ref: '#/parameters/orderId'
    get:
      tags:
        - esOrder
      summary: Get order by id
      operationId: getOrder
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsOrder'
        '400':
          description: Invalid ID supplied
        '404':
          description: Store Item not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  ### End of Orders
  
  # Customers
  ### Cart
  '/customers':
    get:
      tags:
        - esCustomers
      summary: Get the users customer information
      operationId: getUserCustomer
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsCustomer'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
          
parameters:
  limit:
    name: limit
    in: query
    description: Number of items returned
    type: integer
    format: int32
    minimum: 0
    exclusiveMinimum: true
    maximum: 50
    exclusiveMaximum: false
    multipleOf: 10
    default: 20
  cursor:
    name: cursor
    in: query
    description: Start Cursor for query
    type: string
  accountId:
    name: accountId
    in: path
    description: Account Id
    type: string
    required: true
  merchantId:
    name: merchantId
    in: path
    description: Merchant Id
    type: string
    required: true
  orderId:
    name: orderId
    in: path
    description: Order Id
    type: string
    required: true
  itemId:
    name: itemId
    in: path
    description: Store Item Id
    type: string
    required: true
responses:
  Default500ErrorResponse:
    description: An unexpected error occured.
    schema:
      $ref: '#/definitions/EsDefaultError'
  InvalidInputResponse:
    description: Validation exception
  UnauthorizedError:
    description: API key is missing or invalid
    headers:
      WWW_Authenticate:
        type: string
definitions:
  # Extendable Models
  EsBaseId:
    type: object
    properties:
      id:
        type: string
      created:
        type: integer
        format: int32
        readOnly: true
      modified:
        type: integer
        format: int32
        readOnly: true
      version:
        type: string
        readOnly: true
  ### End Extendable Models

  ### Components
  EsDefaultError:
    required:
      - code
      - message
    properties:
      code:
        type: integer
        format: int32
      message:
        type: string

  EsPagination:
    type: object
    properties:
      pageSize:
        type: integer
        format: int32
      nextCursor:
        type: string
      total:
        type: integer
        format: int32
  
  ### Permissions
  EsPermission:
    type: object
    properties:
      id:
        type: string
      creatorId:
        type: string
      entityKind:
        type: string
      entityId:
        type: string
      permissions:
        type: object
  EsPermissionInput:
    type: object
    properties:
      permissions:
        type: object
  EsPagedPermission:
    type: object
    properties:
      pageData:
        $ref: '#/definitions/EsPagination'
      allPermission:
        type: array
        items:
          type: string
      items:
        type: array
        items:
          $ref: '#/definitions/EsPermission'
  EsPermissionCheck:
    type: object
    properties:
      hasPermission:
        type: boolean
  ### End Permissions

  ### Merchant
  EsFeeStructure:
    type: object
    properties:
      perItem:
        type: boolean
        default: true
      feeType:
        type: string
        enum: [fixed, percentage]
      feeMaximum:
        type: integer
      feeMinimum:
        type: integer
        default: 0
      feeAmount:
        type: integer
        
  EsMerchant:
    type: object
    allOf:
      - $ref: '#/definitions/EsBaseId'
      - properties:
          name:
            type: string
          stripeId:
            type: string
          feeStructure:
            type: object
            additionalProperties:
              $ref: '#/definitions/EsFeeStructure'

  EsMerchantSummary:
    type: object
    allOf:
      - $ref: '#/definitions/EsBaseId'
      - properties:
          name:
            type: string

  ### Store
  EsStoreItemUpdate:
    type: object
    properties:
      itemType:
        type: string
      name:
        type: string
      picture:
        type: string
      description:
        type: string
      retailPrice:
        type: integer
      totalInventory:
        type: integer
      merchantId:
        type: string
      saleStart:
        type: integer
      saleEnd:
        type: integer
      forceOpen:
        type: boolean
        default: false
      meta:
        type: object
      
      refundPolicy:
        type: object
      onSaleHook:
        type: object
      onRefundHook:
        type: object
        
 
  EsStoreItem:
    type: object
    allOf:
      - $ref: '#/definitions/EsBaseId'
      - $ref: '#/definitions/EsStoreItemUpdate'
      - properties:
          status:
            type: string
            enum: [onSale, notOnSale, soldOut]
            readOnly: true
          totalSold:
            type: integer
            readOnly: true
          storeId:
            type: string
            readOnly: true

  EsPagedStoreItem:
    type: object
    properties:
      pageData:
        $ref: '#/definitions/EsPagination'
      items:
        type: array
        items:
          $ref: '#/definitions/EsStoreItem'

  ### Cart
  EsCart:
    type: object
    allOf:
      - $ref: '#/definitions/EsBaseId'
      - properties:
          quantity:
            type: integer
          subtotal:
            type: integer
          discountTotal:
            type: integer
          currency:
            type: string
          merchants:
            type: array
            items:
              $ref: '#/definitions/EsMerchantSummary'
          items:
            type: array
            items:
              $ref: '#/definitions/EsCartItem'
  
  EsCartItemInput:
    type: object
    properties:
      quantity:
        type: integer
      discountCodes:
        type: array
        items:
          type: string
  
  EsCartItem:
    type: object
    allOf:
      - $ref: '#/definitions/EsBaseId'
      - properties:
          merchantId:
            type: string
          itemType:
            type: string
          storeId:
            type: string
          name:
            type: string
          picture:
            type: string
          description:
            type: string
          meta:
            type: object
          retailPrice:
            type: integer
          discountPrice:
            type: integer
          quantity:
            type: integer
          subtotal:
            type: integer
          discounts:
            type: array
            items:
              $ref: '#/definitions/EsDiscount'
  
  EsDiscount:
    type: object
    properties:
      discountCode:
        type: string
      discountPrice:
        type: integer

  EsPaymentInput:
    type: object
    properties:
      source:
        type: string
      email:
        type: string
  
  EsOrderItem:
    type: object
    allOf:
      - $ref: '#/definitions/EsCartItem'
      - properties:
          orderId:
            type: string
          feeAmount:
            type: integer
          discountAmount:
            type: integer
          chargeAmount:
            type: integer
          paymentRef:
            type: string
          
  # Order
  EsOrder:
    type: object
    allOf:
      - $ref: '#/definitions/EsCart'
      - properties:
          quantity:
            type: integer
          subtotal:
            type: integer
          discountAmount:
            type: integer
          feeAmount:
            type: integer
          chargeAmount:
            type: integer
          paymentRef:
            type: string
          merchant:
            $ref: '#/definitions/EsMerchantSummary'
          items:
            type: array
            items:
              $ref: '#/definitions/EsOrderItem'

  EsPagedOrder:
    type: object
    properties:
      pageData:
        $ref: '#/definitions/EsPagination'
      items:
        type: array
        items:
          $ref: '#/definitions/EsOrder'
          
  EsCustomer:
    type: object
    allOf:
      - $ref: '#/definitions/EsBaseId'
      - properties:
          email:
            type: string
          savedPaymentMethods:
            type: array
            items:
              type: object