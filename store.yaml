swagger: '2.0'
info:
  description: Store service for eDropin
  version: 1.0.0
  title: eDropin Store
  license:
    name: UNLICENSED
  contact:
    name: Saj Arora
    email: dev@edropin.com
host: store-dot-edropin-play.appspot.com
basePath: /
tags:
  - name: esPermissions
    description: Permissions manager
  - name: esMerchants
    description: Merchant management
  - name: esStore
    description: Store management
  - name: esCart
    description: User Cart for store items
  - name: esOrder
    description: Order items for user
  - name: esCustomers
    description: Customers of eDropin
  - name: esMemberships
    description: Memberships managed in eDropin
  - name: esUserMemberships
    description: User memberships managed in eDropin
schemes:
  - https
produces:
  - application/json
securityDefinitions:
  Authorization:
    type: apiKey
    in: header
    name: Authorization
  AuthorizationOptional:
    type: apiKey
    in: header
    name: Authorization
  ClientKey:
    type: apiKey
    in: header
    name: X-Client-Key
security:
  - ClientKey: []
    Authorization: []
paths:
  '/permissions/accept-invite/{inviteToken}':
    parameters:
      - in: path
        name: inviteToken
        description: Invite Token
        required: true
        type: string
    post:
      tags:
        - esPermissions
      summary: 'Accept a permission invite'
      operationId: acceptPermissionInvite
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsPermission'
        '404':
          description: Permission invite not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
          
  '/permissions/{entityType}/{entityId}/send-invite':
    parameters:
      - $ref: '#/parameters/entityType'
      - $ref: '#/parameters/entityId'
    post:
      tags:
        - esPermissions
      summary: 'Send a permission invite'
      operationId: sendPermissionInvite
      parameters:
        - in: body
          name: permissionInvite
          description: Object for permission invite
          required: true
          schema:
            $ref: '#/definitions/EsPermissionInviteCreate'
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsPagedPermission'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  
  '/permissions/{entityType}/{entityId}/accounts':
    parameters:
      - $ref: '#/parameters/entityType'
      - $ref: '#/parameters/entityId'
      - $ref: '#/parameters/accountId'
    get:
      tags:
        - esPermissions
      summary: Get permissions for entity
      operationId: paginatePermissions
      parameters:
        - $ref: '#/parameters/cursor'
        - $ref: '#/parameters/limit'
      responses:
        '200':
          description: Permissions for account
          schema:
            $ref: '#/definitions/EsPagedPermission'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  
  '/permissions/{entityType}/{entityId}/accounts/{accountId}/check':
    parameters:
      - $ref: '#/parameters/entityType'
      - $ref: '#/parameters/entityId'
      - $ref: '#/parameters/accountId'
    get:
      tags:
        - esPermissions
      summary: Check account has permission
      operationId: hasPermission
      parameters:
        - in: query
          type: string
          required: true
          name: permission
      responses:
        '200':
          description: Account has Permission
          schema:
            $ref: '#/definitions/EsPermissionCheck'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
          
  '/permissions/{entityType}/{entityId}/accounts/{accountId}':
    parameters:
      - $ref: '#/parameters/entityType'
      - $ref: '#/parameters/entityId'
      - $ref: '#/parameters/accountId'
    get:
      tags:
        - esPermissions
      summary: Get permissions for account
      operationId: getPermissionsForAccount
      responses:
        '200':
          description: Permissions for account
          schema:
            $ref: '#/definitions/EsPermission'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
          
  '/merchants/{merchantId}':
    parameters:
      - $ref: '#/parameters/merchantId'
    get:
      tags:
        - esMerchants
      summary: Get a Merchant from the directory
      operationId: getMerchant
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsMerchant'
        '400':
          description: Invalid ID supplied
        '404':
          description: Store Item not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    put:
      tags:
        - esMerchants
      summary: Enable billing
      operationId: enableBilling
      parameters:
        - in: body
          name: stripeCode
          description: Stripe Code To Enable Billing
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Billing updated
          schema:
            $ref: '#/definitions/EsMerchant'
        '400':
          description: Invalid ID supplied
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Profile not found
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/merchants/{merchantId}/sell/{itemType}':
    parameters:
      - $ref: '#/parameters/merchantId'
      - $ref: '#/parameters/itemType'
    put:
      tags:
        - esMerchants
      summary: 'Setup fee structure for merchant [Admin Only]'
      operationId: updateFeeStructure
      parameters:
        - in: body
          name: feeProps
          required: true
          description: Fee structure
          schema:
            $ref: '#/definitions/EsFeeStructure'
      responses:
        '200':
          description: Merchant fee structure updated
          schema:
            $ref: '#/definitions/EsMerchant'
        '400':
          description: Invalid ID supplied
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Profile not found
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    get:
      tags:
        - esMerchants
      summary: Check merchant is able to sell an item type
      operationId: canMerchantSellItem
      responses:
        '200':
          description: Merchant has Permission
          schema:
            $ref: '#/definitions/EsPermissionCheck'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/merchants/{merchantId}/permissions/{accountId}':
    parameters:
      - $ref: '#/parameters/merchantId'
      - $ref: '#/parameters/accountId'
    get:
      tags:
        - esMerchants
      summary: Get permission for account
      operationId: getAccountPermissionForMerchant
      responses:
        '200':
          description: Permissions for account
          schema:
            $ref: '#/definitions/EsPermission'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    put:
      tags:
        - esMerchants
      summary: Set permission for merchant
      operationId: setMerchantPermission
      parameters:
        - in: body
          name: permissionProps
          description: Permissions
          required: true
          schema:
            $ref: '#/definitions/EsPermissionInput'
      responses:
        '200':
          description: Permission set
          schema:
            $ref: '#/definitions/EsPermission'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/merchants/{merchantId}/permissions/{accountId}/check':
    parameters:
      - $ref: '#/parameters/merchantId'
      - $ref: '#/parameters/accountId'
    get:
      tags:
        - esMerchants
      summary: Check account has permission
      operationId: checkAccountHasPermission
      parameters:
        - in: query
          type: string
          required: true
          name: permission
      responses:
        '200':
          description: Account has Permission
          schema:
            $ref: '#/definitions/EsPermissionCheck'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/merchants/{merchantId}/all-permissions':
    parameters:
      - $ref: '#/parameters/merchantId'
    get:
      tags:
        - esMerchants
      summary: List all merchant permissions
      operationId: getMerchantPermission
      parameters:
        - $ref: '#/parameters/cursor'
        - $ref: '#/parameters/limit'
      responses:
        '200':
          description: List of Users with permissions linked to this merchant
          schema:
            $ref: '#/definitions/EsPagedPermission'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/store/{merchantId}/items':
    get:
      parameters:
        - $ref: '#/parameters/merchantId'
        - $ref: '#/parameters/cursor'
        - $ref: '#/parameters/limit'
      tags:
        - esStore
      summary: Get all store items for merchant
      operationId: listStoreItems
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsPagedStoreItem'
        '400':
          description: Invalid ID supplied
        '404':
          description: Store Item not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/store/{merchantId}/items/{itemId}':
    parameters:
      - $ref: '#/parameters/merchantId'
      - $ref: '#/parameters/itemId'
    get:
      tags:
        - esStore
      security:
        - ClientKey: []
          AuthorizationOptional: []
        - ClientKey: []
          Authorization: []
      parameters: 
        - $ref: '#/parameters/enhanced'
      summary: Get a store item from the directory
      operationId: getStoreItem
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsStoreItem'
        '400':
          description: Invalid ID supplied
        '404':
          description: Store Item not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    put:
      tags:
        - esStore
      summary: Upsert a store item
      operationId: upsertStoreItem
      parameters:
        - in: body
          name: storeItemProps
          description: Store Item that needs to be upserted
          required: true
          schema:
            $ref: '#/definitions/EsStoreItemUpdate'
      responses:
        '200':
          description: Store Item updated
          schema:
            $ref: '#/definitions/EsStoreItem'
        '400':
          description: Invalid ID supplied
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Store Item not found
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    delete:
      tags:
        - esStore
      summary: Delete an existing Store Item
      operationId: deleteStoreItem
      responses:
        '204':
          description: Event deleted
          schema:
            $ref: '#/definitions/EsStoreItem'
        '400':
          description: Invalid ID supplied
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: StoreItem not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/store/get-multi':
    get:
      tags:
        - esStore
      security:
        - ClientKey: []
          AuthorizationOptional: []
        - ClientKey: []
          Authorization: []
      parameters:
        - in: query
          name: storeIds
          type: array
          items:
            type: string
        - $ref: '#/parameters/enhanced'
      summary: Get multip store items from the directory
      operationId: getMultipleStoreItems
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsPagedStoreItem'
        '400':
          description: Invalid ID supplied
        '404':
          description: Store Item not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'

  '/cart/{currencyCode}':
    parameters:
      - $ref: '#/parameters/currencyCode'
    get:
      tags:
        - esCart
      summary: Get the users active cart for currency code
      operationId: getCartForCurrencyCode
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsCart'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    delete:
      tags:
        - esCart
      summary: Empty the user cart
      operationId: emptyCart
      responses:
        '204':
          description: Cart deleted
          schema:
            $ref: '#/definitions/EsCart'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Cart not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  
  '/cart/{currencyCode}/items/{merchantId}/{itemId}':
    parameters:
      - $ref: '#/parameters/currencyCode'
      - $ref: '#/parameters/merchantId'
      - $ref: '#/parameters/itemId'
    put:
      tags:
        - esCart
      summary: Upsert item to cart
      operationId: upsertCartItem
      parameters:
        - in: body
          name: cartItemProps
          description: Cart Item that needs to be upserted
          required: true
          schema:
            $ref: '#/definitions/EsCartItemInput'
      responses:
        '200':
          description: Cart Item upserted
          schema:
            $ref: '#/definitions/EsCartItemChangeResponse'
        '400':
          description: Invalid ID supplied
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Cart Store Item not found
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    delete:
      tags:
        - esCart
      summary: Delete a cart item
      operationId: deleteCartItem
      responses:
        '204':
          description: Cart Item deleted
          schema:
            $ref: '#/definitions/EsCartItemChangeResponse'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Cart Item not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/cart/{currencyCode}/promotionalCodes':
    parameters:
      - $ref: '#/parameters/currencyCode'
    post:
      tags:
        - esCart
      summary: Promotional codes and memberships can be entered here
      operationId: verifyAndAddPromotion
      parameters:
        - in: body
          name: promoProps
          description: Promotional codes
          required: true
          schema:
            $ref: '#/definitions/EsPromotionInput'
      responses:
        '200':
          description: Updated Cart
          schema:
            $ref: '#/definitions/EsCartItemChangeResponse'
        '400':
          description: Invalid ID supplied
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Cart Store Item not found
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/cart/{currencyCode}/validate':
    parameters:
      - $ref: '#/parameters/currencyCode'
    post:
      tags:
        - esCart
      summary: Validate Cart for a currency to ensure all items are available and pricing is all up to date and there are not potential conflicts
      operationId: validateCart
      responses:
        '200':
          description: Cart Item validated
          schema:
            $ref: '#/definitions/EsCart'
        '400':
          description: Invalid ID supplied
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Cart Store Item not found
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/cart/{currencyCode}/checkout':
    parameters:
      - $ref: '#/parameters/currencyCode'
    post:
      tags:
        - esCart
      summary: Endpoint to charge the customer for the items in their cart.
      parameters:
        - in: body
          name: paymentProps
          description: Payment props for checkout
          required: true
          schema:
            $ref: '#/definitions/EsPaymentInput'
      operationId: checkoutCart
      responses:
        '200':
          description: List of orderItems grouped by merchant as Order that the user has checked out
          schema:
            $ref: '#/definitions/EsCheckout'
        '400':
          description: Invalid ID supplied
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Cart Store Item not found
        '405':
          $ref: '#/responses/InvalidInputResponse'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  /orders:
    get:
      tags:
        - esOrder
      summary: Get orders for current user
      parameters:
        - in: query
          name: orderBy
          required: false
          type: string
          enum:
            - 'modified'
            - 'created'
        - $ref: '#/parameters/cursor'
        - $ref: '#/parameters/limit'
      operationId: listUserOrders
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsPagedOrder'
        '400':
          description: Invalid ID supplied
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/orders/{orderId}':
    parameters:
      - $ref: '#/parameters/orderId'
    get:
      tags:
        - esOrder
      summary: Get order by id
      security:
        - ClientKey: []
          AuthorizationOptional: []
        - ClientKey: []
          Authorization: []
      operationId: getOrder
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsCart'
        '400':
          description: Invalid ID supplied
        '404':
          description: Store Item not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/orders/{orderId}/items':
    parameters:
      - $ref: '#/parameters/orderId'
    get:
      tags:
        - esOrder
      summary: List order items
      operationId: listOrderItems
      parameters:
        - $ref: '#/parameters/cursor'
        - $ref: '#/parameters/limit'
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsPagedOrderItem'
        '400':
          description: Invalid ID supplied
        '404':
          description: Store Item not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/merchants/{merchantId}/order-items':
    get:
      tags:
        - esOrder
      summary: List merchant order items
      operationId: listOrderItemsByMerchant
      parameters:
        - $ref: '#/parameters/merchantId'
        - in: query
          name: category
          description: Type of store item category e.g. Event
          type: string
          required: false
        - in: query
          name: categoryId
          description: Category id e.g [Event Id]
          type: string
          required: false
        - in: query
          name: storeItemId
          description: Store item id e.g. EventTicket-ab2333
          required: false
          type: string
        - $ref: '#/parameters/cursor'
        - $ref: '#/parameters/limit'
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/EsPagedOrderItem'
        '400':
          description: Invalid ID supplied
        '404':
          description: Store Item not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/orders/{orderId}/order-items/{orderItemId}/start-refund':
    parameters:
      - $ref: '#/parameters/orderId'
      - $ref: '#/parameters/orderItemId'
    post:
      tags:
        - esOrder
      summary: Start the refund process for item
      parameters:
        - in: body
          name: refundProps
          description: Refund options
          required: true
          schema:
            $ref: '#/definitions/EsRefundInput'
      operationId: startRefundForItem
      responses:
        '200':
          description: Order Item
          schema:
            $ref: '#/definitions/EsOrderItem'
        '400':
          description: Invalid Request
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Order Item not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/orders/{orderId}/order-items/{orderItemId}/merchant-refund':
    parameters:
      - $ref: '#/parameters/orderId'
      - $ref: '#/parameters/orderItemId'
    post:
      tags:
        - esOrder
      summary: Start the refund process for item [merchant]
      parameters:
        - in: body
          name: refundProps
          description: Refund options
          required: true
          schema:
            $ref: '#/definitions/EsRefundInput'
      operationId: startMerchantRefundForItem
      responses:
        '200':
          description: Order Item
          schema:
            $ref: '#/definitions/EsOrderItem'
        '400':
          description: Invalid Request
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Order Item not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  /customers:
    get:
      tags:
        - esCustomers
      summary: Get the users current customer information
      operationId: getUserCustomer
      parameters:
        - $ref: '#/parameters/expand'
      responses:
        '200':
          description: OK
          schema:
            type: array
            items:
              $ref: '#/definitions/EsCustomer'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    put:
      tags:
        - esCustomers
      summary: Update a customer
      operationId: updateCustomer
      parameters:
        - in: body
          name: customerProps
          description: Customer input
          required: true
          schema:
            $ref: '#/definitions/EsCustomerInput'
      responses:
        '200':
          description: A new Customer
          schema:
            $ref: '#/definitions/EsCustomer'
        '400':
          description: Invalid attributes
        '401':
          $ref: '#/responses/UnauthorizedError'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/customers/cards':
    get:
      tags:
        - esCustomers
      summary: Retrieve all saved cards for customer
      operationId: listAllCards
      responses:
        '200':
          description: A new Customer
          schema:
            type: object
            properties:
              items:
                type: array
                items: 
                  $ref: '#/definitions/EsCard'
        '400':
          description: Invalid attributes
        '401':
          $ref: '#/responses/UnauthorizedError'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  
  '/customers/cards/{cardId}':
    parameters:
      - $ref: '#/parameters/cardId'
    delete:
      tags:
        - esCustomers
      summary: Remove a card
      operationId: removeCard
      responses:
        '200':
          description: Card removed
          schema:
            $ref: '#/definitions/EsSuccess'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  /memberships:
    get:
      tags:
        - esMemberships
      summary: Get Memberships
      operationId: getAllMemberships
      parameters:
        - $ref: '#/parameters/searchQuery'
        - $ref: '#/parameters/searchFacets'
        - $ref: '#/parameters/cursor'
        - $ref: '#/parameters/limit'
      responses:
        '200':
          description: Memberships
          schema:
            $ref: '#/definitions/EsPagedMembership'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    post:
      tags:
        - esMemberships
      summary: Create Membership
      operationId: createMembership
      parameters:
        - in: body
          name: membershipProps
          description: Membership object that needs to be created
          required: true
          schema:
            $ref: '#/definitions/EsMembershipUpdate'
      responses:
        '200':
          description: Membership created
          schema:
            $ref: '#/definitions/EsMembership'
        '400':
          $ref: '#/responses/InvalidInputResponse'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/memberships/{membershipId}':
    parameters:
      - $ref: '#/parameters/membershipId'
    get:
      tags:
        - esMemberships
      summary: Get a membership from eDropin
      operationId: getMembership
      responses:
        '200':
          description: Membership
          schema:
            $ref: '#/definitions/EsMembership'
        '404':
          description: Membership not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    put:
      tags:
        - esMemberships
      summary: Update an existing membership
      operationId: updateMembership
      parameters:
        - in: body
          name: membershipProps
          description: Membership object that needs to be updated
          required: true
          schema:
            $ref: '#/definitions/EsMembershipUpdate'
      responses:
        '200':
          description: Membership updated
          schema:
            $ref: '#/definitions/EsMembership'
        '400':
          $ref: '#/responses/InvalidInputResponse'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Membership not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    delete:
      tags:
        - esMemberships
      summary: Delete an existing membership
      operationId: deleteMembership
      responses:
        '200':
          description: Membership deleted
          schema:
            $ref: '#/definitions/EsSuccess'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '404':
          description: Membership not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
          
  '/memberships/{membershipId}/members':
    parameters:
      - $ref: '#/parameters/membershipId'
    get:
      tags:
        - esMemberships
      summary: Get members for a membership
      operationId: getMembers
      parameters:
        - $ref: '#/parameters/cursor'
        - $ref: '#/parameters/limit'
      responses:
        '200':
          description: Members belonging to this membership
          schema:
            $ref: '#/definitions/EsPagedMember'
        '404':
          description: Membership not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    put:
      tags:
        - esMemberships
      summary: Update an existing membership
      operationId: updateMembers
      parameters:
        - in: body
          name: memberProps
          description: Members that need to be updated/deleted
          required: true
          schema:
            $ref: '#/definitions/EsMembersUpdate'
      responses:
        '200':
          description: Membership updated
          schema:
            $ref: '#/definitions/EsPagedMember'
        '404':
          description: Membership not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/memberships/{membershipId}/members/tasks':
    parameters:
      - $ref: '#/parameters/membershipId'
    delete:
      tags:
        - esMemberships
      summary: Delete all members in the membership [cloud tasks]
      security: []
      operationId: deleteMembersTask
      parameters:
        - in: query
          name: apiKey
          type: string
          required: true
      responses:
        '200':
          description: Members deleted
          schema:
            $ref: '#/definitions/EsSuccess'
        '404':
          description: Membership not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/user-memberships':
    get:
      tags:
        - esUserMemberships
      summary: List current user memberships
      operationId: listUserMemberships
      parameters:
        - $ref: '#/parameters/searchQuery'
        - $ref: '#/parameters/searchFacets'
        - $ref: '#/parameters/cursor'
        - $ref: '#/parameters/limit'
      responses:
        '200':
          description: Customer Memberships
          schema:
            $ref: '#/definitions/EsPagedUserMembership'
        '401':
          $ref: '#/responses/UnauthorizedError'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    post:
      tags:
        - esUserMemberships
      summary: Add a membership to a user
      operationId: addUserMembership
      parameters:
        - in: body
          name: membershipProps
          description: Membership object to be added
          required: true
          schema:
            $ref: '#/definitions/EsUserMembershipUpdate'
      responses:
        '200':
          description: Membership created
          schema:
            $ref: '#/definitions/EsMembership'
        '500':
          $ref: '#/responses/Default500ErrorResponse'
  '/user-memberships/{userMembershipId}':
    parameters:
      - $ref: '#/parameters/userMembershipId'
    put:
      tags:
        - esUserMemberships
      summary: Update an existing user membership
      operationId: updateUserMembership
      parameters:
        - in: body
          name: membershipProps
          description: Membership object that needs to be updated
          required: true
          schema:
            $ref: '#/definitions/EsUserMembershipUpdate'
      responses:
        '200':
          description: Membership updated
          schema:
            $ref: '#/definitions/EsUserMembership'
        '404':
          description: Membership not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
    delete:
      tags:
        - esUserMemberships
      summary: Delete an existing membership
      operationId: removeUserMembership
      responses:
        '200':
          description: Membership deleted
          schema:
            $ref: '#/definitions/EsSuccess'
        '404':
          description: Membership not found
        '500':
          $ref: '#/responses/Default500ErrorResponse'
parameters:
  entityType:
    name: entityType
    in: path
    description: Entity Type
    type: string
    required: true
  entityId:
    name: entityId
    in: path
    description: Entity Id
    type: string
    required: true
  limit:
    name: limit
    in: query
    description: Number of items returned
    type: integer
    format: int32
    minimum: 0
    exclusiveMinimum: true
    maximum: 100
    exclusiveMaximum: false
    multipleOf: 10
    default: 20
  cursor:
    name: cursor
    in: query
    description: Start Cursor for query
    type: string
  accountId:
    name: accountId
    in: path
    description: Account Id
    type: string
    required: true
  cartId:
    name: cartId
    in: path
    description: Cart Id
    type: string
    required: true
  enhanced:
    name: enhanced
    in: query
    description: Gives you a more detailed entity but requires admin permissions usually
    type: boolean
    required: false
  cardId:
    name: cardId
    in: path
    description: Card Id
    type: string
    required: true
  expand:
    in: query
    name: expand
    description: Expands the properties in the array
    type: array
    items:
      type: string
    required: false
  membershipId:
    name: membershipId
    in: path
    description: Membership Id
    type: string
    required: true
  merchantId:
    name: merchantId
    in: path
    description: Merchant Id
    type: string
    required: true
  orderId:
    name: orderId
    in: path
    description: Order Id
    type: string
    required: true
  orderItemId:
    name: orderItemId
    in: path
    description: Order Item Id
    type: string
    required: true
  itemId:
    name: itemId
    in: path
    description: Store Item Id
    type: string
    required: true
  itemType:
    name: itemType
    in: path
    description: Store Item Type
    type: string
    required: true
  currencyCode:
    name: currencyCode
    in: path
    description: Currency Code
    type: string
    required: true
  searchQuery:
    in: query
    name: q
    type: string
  searchFacets:
    in: query
    name: facets
    type: string
    description: 'e.g JSON.stringify([profiledIds:edropin],[profileIds:agdontario])'
  userMembershipId:
    name: userMembershipId
    in: path
    description: User membership id
    type: string
    required: true

responses:
  Default500ErrorResponse:
    description: An unexpected error occured.
    schema:
      $ref: '#/definitions/EsDefaultError'
  InvalidInputResponse:
    description: Validation exception
  UnauthorizedError:
    description: API key is missing or invalid
    headers:
      WWW_Authenticate:
        type: string
definitions:
  EsBaseId:
    type: object
    properties:
      id:
        type: string
      createdOn:
        type: string
        readOnly: true
      modifiedOn:
        type: string
        readOnly: true
  EsSuccess:
    type: object
    properties:
      success:
        type: boolean
      message:
        type: object
  EsDefaultError:
    required:
      - code
      - message
    properties:
      code:
        type: integer
        format: int32
      message:
        type: string
  EsPagination:
    type: object
    properties:
      pageSize:
        type: integer
        format: int32
      nextCursor:
        type: string
      total:
        type: integer
        format: int32
  EsPermissionInviteCreate:
    type: object
    required:
      - emails
      - permissions
    properties:
      emails:
        type: array
        items:
          type: string
      permissions:
        type: array
        items:
          type: string
      message:
        type: string
        
  EsPermission:
    type: object
    properties:
      id:
        type: string
      modifiedOn:
        type: string
      creatorId:
        type: string
      entityType:
        type: string
      entityId:
        type: string
      permissions:
        type: object
      email:
        type: string
      message:
        type: string
      acceptedWhen:
        type: integer
      declinedWhen:
        type: integer
      acceptedById:
        type: string
      acceptedByName:
        type: string
      
  EsPermissionInput:
    type: object
    properties:
      permissions:
        type: object
  EsPagedPermission:
    type: object
    properties:
      pageData:
        $ref: '#/definitions/EsPagination'
      allPermission:
        type: array
        items:
          type: string
      items:
        type: array
        items:
          $ref: '#/definitions/EsPermission'
  EsPermissionCheck:
    type: object
    properties:
      hasPermission:
        type: boolean
  
  EsFeeStructure:
    type: object
    required:
      - feeType
      - feeAmount
      - refundFeeAmount
    properties:
      perItem:
        type: boolean
        default: true
      active:
        type: boolean
        default: true
      feeType:
        type: string
        enum:
          - fixed
          - percentage
          - none
      feeMaximum:
        type: integer
      feeMinimum:
        type: integer
        default: 0
      feeAmount:
        type: integer
        default: 0
      refundFeeAmount:
        type: integer
  EsMerchant:
    type: object
    required:
      - name
      - stripeId
    allOf:
      - $ref: '#/definitions/EsBaseId'
      - properties:
          name:
            type: string
          stripeId:
            type: string
          feeStructure:
            type: object
            additionalProperties:
              $ref: '#/definitions/EsFeeStructure'
  EsStoreItemUpdate:
    type: object
    required:
      - name
      - category
      - categoryId
      - itemType
      - totalInventory
      - priceStrategy
      - startSaleTimestamp
      - endSaleTimestamp
    properties:
      category:
        type: string
      categoryId:
        type: string
      itemType:
        type: string
      name:
        type: string
      picture:
        type: string
      description:
        type: string
      priceStrategy:
        type: "array"
        items:
          $ref: "#/definitions/EsPriceStrategy"
      totalInventory:
        type: integer
        format: int32
      startSaleTimestamp:
        type: integer
      endSaleTimestamp:
        type: integer
      policy:
        type: string
      extra:
        type: object
      status:
        type: string
        enum:
          - open
          - closed
          - soldOut
  EsPriceStrategy:
    type: object
    required:
      - retailPrice
      - currencyCode
    properties:
      retailPrice:
        type: integer
        format: int32
      currencyCode:
        type: string
      discounts:
        type: array
        items:
          $ref: '#/definitions/EsDiscount'
      refundPolicies:
        type: array
        items:
          $ref: '#/definitions/EsRefundPolicy'

  EsRefundPolicy:
    type: object
    required:
      - startTimestamp
      - endTimestamp
      - feeAmount
    properties:
      policyId:
        type: string
      policyName:
        type: string
      disclaimer:
        type: string
      appFeeRefundAmount: 
        type: number
      platformFee:
        type: number
      startTimestamp:
        type: integer
      endTimestamp:
        type: integer
      feeAmount:
        type: integer
      refundAmount:
        type: integer
      isDifferenceCharged:
        type: boolean
        default: false
  
  EsRefundInput:
    type: object
    required:
      - quantity
      - reason
      - feeAmount
    properties:
      quantity:
        type: integer
      reason:
        type: string
        enum:
          - 'requested_by_customer'
          - 'duplicate'
          - 'fraudulent'
      agreedDeduction:
        type: integer
      message:
        type: string
      
  EsDiscount:
    type: object
    required:
      - discountType
      - discountPrice
      - startTimestamp
      - endTimestamp
    properties:
      discountType:
        type: string
        enum:
          - membership
          - referralCode
      referralCode:
        type: string
      discountPrice:
        type: integer
        format: int32
      startTimestamp:
        type: integer
        format: int32
      endTimestamp:
        type: integer
        format: int32
      membershipId:
        type: integer
      membershipName:
        type: string
            
  EsStoreItem:
    type: object
    allOf:
      - $ref: '#/definitions/EsBaseId'
      - $ref: '#/definitions/EsStoreItemUpdate'
      - properties:
          merchantId:
            type: string
          merchantName:
            type: string
          totalSold:
            type: integer
            format: int32
          priceSummary:
            type: array
            items:
              $ref: '#/definitions/EsPriceSummary'
              
  EsPriceSummary:
    type: object
    properties:
      currencyCode:
        type: string
      retailPrice:
        type: integer
        format: int32
      adDiscounts:
        type: array
        items:
          $ref: '#/definitions/EsDiscount'
      refundPolicies:
        type: array
        items:
          $ref: '#/definitions/EsRefundPolicy'
  
  EsPagedStoreItem:
    type: object
    properties:
      pageData:
        $ref: '#/definitions/EsPagination'
      items:
        type: array
        items:
          $ref: '#/definitions/EsStoreItem'
  EsCartItemChangeResponse:
    type: object
    properties:
      success:
        type: boolean
      error:
        type: object
      cart:
        $ref: '#/definitions/EsCart'
      orderItems:
        type: array
        items:
          $ref: '#/definitions/EsOrderItem'
  EsCart:
    type: object
    allOf:
      - $ref: '#/definitions/EsBaseId'
      - properties:
          ownerId:
            type: string
          checkedOutWhen:
            type: integer
          isCheckedOut: 
            type: boolean 
            default: false
          subtotal: 
            type: integer 
            default: 0 
          quantity: 
            type: integer 
            default: 0 
          validationExpiry: 
            type: integer 
            default: 0 
          lockedUntil: 
            type: integer 
            default: 0 
          customerId: 
            type: string
          stripeFee: 
            type: integer 
            default: 0 
          platformFee:
            type: integer 
            default: 0 
          merchantInvoices:
            type: object
          availableQuantity: 
            type: integer 
            default: 0 
          refundTotal: 
            type: integer 
            default: 0 
          isRefunded: 
            type: boolean
          userEmail: 
            type: string
          userName: 
            type: string
          userPhone:
            type: string
          storeItemIds:
            type: array
            items:
              type: string
          itemIds:
            type: array
            items:
              type: string
          currencyCode:
            type: string
            readOnly: true
          items:
            type: object
            additionalProperties:
              type: object
              additionalProperties:
                type: object
                properties:
                  subtotal:
                    type: integer
                  quantity:
                    type: integer
          status:
            type: string
          statusMessages:
            type: array
            items:
              $ref: '#/definitions/EsStatusMessage'
          merchantErrors:
            type: object
            additionalProperties:
              $ref: '#/definitions/EsDefaultError'
          failedItems:
            type: array
            items:
              $ref: '#/definitions/EsOrderItem'
          orderItems:
            type: array
            items:
              $ref: '#/definitions/EsOrderItem'
          storeItems:
            type: array
            items:
              $ref: '#/definitions/EsStoreItem'
          claimCode:
            type: string
            
  EsCartItemInput:
    type: object
    properties:
      quantity:
        type: integer
  
  EsAppliedPromotion:
    type: object
    properties:
      discountType:
        type: string
      discountPrice:
        type: integer
      timestamp:
        type: integer
      referralCode:
        type: string
      membershipId:
        type: integer
      membershipName:
        type: string
      memberId:
        type: string
  
  EsPromotionInput:
    type: object
    properties:
      referralCode:
        type: string
      membershipId:
        type: integer
      memberId:
        type: string
  
  EsPaymentInput:
    type: object
    required:
      - email
      - name
    properties:
      source:
        type: string
      email:
        type: string
      name:
        type: string
      paymentMethodId:
        type: string 
  
  EsStatusMessage:
    type: object
    properties:
      timestamp:
        type: integer
      message:
        type: string
  
  EsOrderItemStatus:
    type: object
    properties:
      id:
        type: string
      active:
        type: boolean
        default: true
      isRefunded:
        type: boolean
        default: false
      refundId:
        type: string
      
  EsOrderItemRefund:
    type: object
    properties:
      id:
        type: string
      amount:
        type: integer
      charge:
        type: string
      created:
        type: integer
      currency:
        type: string
      reason: 
        type: string
      status:
        type: string
      usedRefundPolicy:
        $ref: '#/definitions/EsRefundPolicy'
     
  EsOrderItem:
    type: object
    allOf:
      - $ref: '#/definitions/EsBaseId'
      - properties:
          cartId:
            type: string
          isCheckedOut:
            type: boolean
            default: false
          checkedOutWhen:
            type: integer
          storeItemId:
            type: string
          chargeId:
            type: string
          stripeFee:
            type: integer
          customerId:
            type: string
          feeId:
            type: string
          currencyCode:
            type: string
          name:
            type: string
          itemType:
            type: string
          category:
            type: string
          categoryId:
            type: string
          description:
            type: string
          picture:
            type: string
          retailPrice:
            type: integer
          salePrice:
            type: integer
          status:
            type: string
          userName:
            type: string
          userEmail:
            type: string
          userPhone:
            type: string
          statusMessages:
            type: array
            items:
              $ref: '#/definitions/EsStatusMessage'
          merchantId:
            type: string
          merchantName:
            type: string
          quantity:
            type: integer
          availableQuantity:
            type: integer
            description: Number of items available after refunds
          platformFee:
            type: integer
          processingRefundFee:
            type: integer
          subtotal:
            type: integer
          policy:
            type: string
          itemStatus:
            type: array
            items:
              $ref: '#/definitions/EsOrderItemStatus'
          submittedRefunds:
            type: array
            items:
              $ref: '#/definitions/EsOrderItemRefund'
          refundPolicies:
            type: array
            items:
              $ref: '#/definitions/EsRefundPolicy'
          refundTotal:
            type: integer
            description: Total amount of money refunded for this order item
          extra:
            type: object
          appliedPromotion:
            $ref: '#/definitions/EsAppliedPromotion'
          
  EsPagedOrderItem:
    type: object
    properties:
      pageData:
        $ref: '#/definitions/EsPagination'
      items:
        type: array
        items:
          $ref: '#/definitions/EsOrderItem'
  EsPagedOrder:
    type: object
    properties:
      pageData:
        $ref: '#/definitions/EsPagination'
      items:
        type: array
        items:
          $ref: '#/definitions/EsCart'
      orderItems:
        type: array
        items:
          $ref: '#/definitions/EsOrderItem'
  EsCustomerInput:
    type: object
    required:
      - defaultCurrency
    properties:
      defaultCurrency:
        type: string
        enum: [cad, usd]
      lastCurrency:
        type: string
        enum: [cad, usd]
      defaultPaymentId:
        type: string
      name:
        type: string
      email:
        type: string
  EsCustomer:
    type: object
    allOf:
      - $ref: '#/definitions/EsBaseId'
      - $ref: '#/definitions/EsCustomerInput'
      - properties:
          savedCards:
            type: array
            items:
              $ref: '#/definitions/EsCard'
  EsCheckout:
    type: object
    properties:
      success:
        type: boolean
      order:
        $ref: '#/definitions/EsCart'
      cart:
        $ref: '#/definitions/EsCart'
      error:
        $ref: '#/definitions/EsDefaultError'
      claimCode:
        type: string
  EsCard:
    type: object
    properties:
      id:
        type: string
      name:
        type: string
      email:
        type: string
      brand:
        type: string
      country:
        type: string
      last4:
        type: string
      expiryMonth:
        type: integer
      expiryYear:
        type: integer
  
  EsUserMembershipUpdate:
    type: object
    required:
      - membershipId
      - membershipName
      - memberId
    properties:
      membershipId:
        type: integer
      membershipName:
        type: string
      memberId:
        type: string
        
  EsUserMembership:
    type: object
    allOf:
      - $ref: '#/definitions/EsBaseId'
      - $ref: '#/definitions/EsUserMembershipUpdate'
      - properties:
          id:
            type: string
          membershipId:
            type: integer
          membershipName:
            type: string
          memberId:
            type: string
  
  EsPagedUserMembership:
    type: object
    properties:
      pageData:
        $ref: '#/definitions/EsPagination'
      facets:
        type: object
      items:
        type: array
        items:
          $ref: '#/definitions/EsUserMembership' 
          
  EsMembershipUpdate:
    type: object
    required:
      - name
      - agreeTerms
      - organizerId
    properties:
      name:
        type: string
      organizerId:
        type: string
      description:
        type: string
      agreeTerms:
        type: string
        enum:
          - v1
  
  EsMembership:
    type: object
    allOf:
      - $ref: '#/definitions/EsBaseId'
      - $ref: '#/definitions/EsMembershipUpdate'
      - properties:
          totalMembers:
            type: integer
          totalActiveMembers:
            type: integer
  
  EsPagedMembership:
    type: object
    properties:
      pageData:
        $ref: '#/definitions/EsPagination'
      facets:
        type: object
      items:
        type: array
        items:
          $ref: '#/definitions/EsMembership'
  
  EsMember:
    type: object
    properties:
      id:
        type: string
      memberId:
        type: string
      firstName:
        type: string
      lastName:
        type: string
      title:
        type: string
      name:
        type: string
      email:
        type: string
      active:
        type: boolean
        default: true
      memberSince:
        type: number
        
  EsMembersUpdate:
    type: object
    required:
      - members
    properties:
      members:
        type: array
        items:
          type: object
          required:
            - action
            - memberId
          allOf:
            - $ref: '#/definitions/EsMember'
            - properties:
                action:
                  type: string
                  enum:
                    - 'delete'
                    - 'update'
                  default: 'update'
  
  EsPagedMember:
    type: object
    properties:
      pageData:
        $ref: '#/definitions/EsPagination'
      items:
        type: array
        items:
          $ref: '#/definitions/EsMember'
      deleted:
        type: array
        items:
          type: string